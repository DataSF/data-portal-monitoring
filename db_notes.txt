
\du --> shows users


\l shows databases



create database ubuntu;
ALTER DATABASE ubuntu OWNER TO ubuntu;

alter user ubuntu with CREATEDB;
alter user ubuntu with CREATEROLE;
GRANT ALL PRIVILEGES ON DATABASE ubuntu to ubuntu;
alter user ubuntu with superuser;

create database monitoring;
GRANT ALL PRIVILEGES ON DATABASE monitoring to ubuntu;
ALTER DATABASE monitoring OWNER TO ubuntu;
ALTER USER "ubuntu" WITH PASSWORD 'somepass';
// add timescaledb extension to the db:
CREATE EXTENSION IF NOT EXISTS timescaledb CASCADE;



To log on
//psql -d monitoring -U ubuntu -h localhost


select count(*) from (
select datasetid, count(*) from  (
 SELECT datasetid, time
          FROM portal_activity
                LEFT JOIN (
                    SELECT MAX(TIME) AS max_time FROM portal_activity
                )m ON 1=1
          WHERE time > m.max_time - interval '60 minutes'
          GROUP BY datasetid, time
)  as z 
 GROUP BY datasetid 
 having count(*) > 1 ) zz




 			SELECT a.datasetid, last_seen
 			FROM  
 			(	
  				SELECT datasetid as datasetid, last(time, time) as last_seen
  				FROM portal_activity
  				WHERE time < NOW() - interval '60 minutes'
  				GROUP BY datasetid
  			) a 
  			LEFT JOIN 
  			(
  				SELECT datasetid, last(time, time)
  				FROM portal_activity
  				WHERE time > NOW() - interval '60 minutes'
  				GROUP BY datasetid
  			) b
  			ON a.datasetid = b.datasetid
  			WHERE b.datasetid is NULL;